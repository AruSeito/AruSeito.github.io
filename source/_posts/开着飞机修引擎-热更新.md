---
title: 开着飞机修引擎---热更新
categories:
  - 前端工程化
tags:
  - webpack
  - 热更新
index_img: https://cdn.jsdelivr.net/gh/AruSeito/AruSeito.github.io@main/source/img/banner/bg12.jpg
banner_img: https://cdn.jsdelivr.net/gh/AruSeito/AruSeito.github.io@main/source/img/banner/bg12.jpg
date: 2021-03-16 15:17:54
---

在自己刚开始学习前端的时候，每次修改个新样式都要手动刷新一下页面。随着自己对前端的了解，开始使用了 live reload 插件进行代替，每次更改文件后，浏览器都会代替人工来刷新页面。随着后面的学习 React，发现使用 CRA 创建的东西可以在开着服务的时候进行不刷新就替换内容。

## live reload

使用 webpack 的 dev-server 模拟当年的 nginx+live-reload 插件
webpack 配置如下：

```javascript
const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");

module.exports = {
  entry: "./src/index.js",
  mode: "development",
  plugins: [
    new HtmlWebpackPlugin({
      title: "Development",
    }),
  ],
  output: {
    filename: "[name].bundle.js",
    path: path.resolve(__dirname, "dist"),
    clean: true,
  },
  devServer: {
    contentBase: "./dist",
    open: true,
  },
};
```

打开页面后，打开控制台的 network 标签可以看到其中有一条是 websocket 的连接。

![websocket](https://cdn.jsdelivr.net/gh/AruSeito/AruSeito.github.io@main/source/img/websocket.png)

查看这条记录，发现内部写了要进行的操作，以及更新的文件 hash 值（可以与上图中文件的 hash 对比一下，是完全一致的）。

![websocket内容](https://cdn.jsdelivr.net/gh/AruSeito/AruSeito.github.io@main/source/img/websocket-content.png.png)

通过这个 websocket 链接，就可以使打开的网页和本地服务间建立持久化的通信。当源代码发生变更时，就通过 Socket 通知到浏览器，浏览器在接到通知后会自动触发页面刷新。
